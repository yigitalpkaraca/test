<!DOCTYPE html>
<html lang="tr">

<head>
    <link rel="icon" type="image/webp" href="{{ url_for('static', filename='favicon.webp') }}">
    <meta charset="UTF-8">
    <title>KapÄ± KapÄ±</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <header class="main-header">
        <div class="container nav">
            <div class="logo"> <a href="{{ url_for('home') }}" class="logo">
                    <img src="{{ url_for('static', filename='favicon.webp') }}" alt="kutu kutu logo" class="logo-img">
                </a>KapÄ± KapÄ±

            </div>
            <nav class="nav-right">
                <ul class="nav-links">
                    <ul class="nav-links">
                    <li><a href="{{ url_for('home') }}">Ana Sayfa</a></li>
                    <li><a href="{{ url_for('send') }}">GÃ¶nderi OluÅŸtur</a></li>
    
                    {% if session.get('user_name') %}
                        <li style="color: #0dbf87; font-weight: 700;">HoÅŸ geldin, {{ session['user_name'] }}</li>
                        <li><a href="{{ url_for('logout') }}" style="color: #ff7a1a;">Ã‡Ä±kÄ±ÅŸ Yap</a></li>
                    {% else %}
                        <li><a href="{{ url_for('track') }}">GÃ¶nderi Takip</a></li>
                        <li><a href="{{ url_for('login') }}" style="color: #ff7a1a; font-weight: 600;">GiriÅŸ Yap</a></li>
                    {% endif %}
                    {% if session.get('user_type') == 'kurye' %}
                        <li><a href="{{ url_for('courier') }}">GÃ¶nderi Kabul</a></li>
                    {% endif %}
</ul>
                </ul>
                <a href="{{ url_for('send') }}" class="btn btn-small">Hemen GÃ¶nder</a>
            </nav>
        </div>
    </header>

    <main class="page-main">
        <section class="page-header">
            <div class="container">
                <h1>GÃ¶nderi OluÅŸtur</h1>
                <p>Åehir iÃ§i paketini gÃ¶ndermek iÃ§in formu doldur.</p>
            </div>
        </section>

        <section class="form-section">
            <div class="container form-layout">
                <form class="main-form" id="shipmentForm">
                    <div id="formMessage"></div>
                    <h2>GÃ¶nderici Bilgileri</h2>
                    <div class="form-grid">
                        <label>
                            Ä°sim Soyisim
                            <input type="text" name="sender_name" id="sender_name" placeholder="GÃ¶nderici adÄ±" required>
                        </label>
                        <label>
                            Telefon
                            <input type="tel" name="sender_phone" id="sender_phone" placeholder="05XX XXX XX XX" required>
                        </label>
                    </div>
                    <label>
                        Adres
                        <input type="text" name="sender_address" id="sender_address" placeholder="Mahalle, sokak, bina, daire" required>
                    </label>

                    <h2>AlÄ±cÄ± Bilgileri</h2>
                    <div class="form-grid">
                        <label>
                            Ä°sim Soyisim
                            <input type="text" name="receiver_name" id="receiver_name" placeholder="AlÄ±cÄ± adÄ±" required>
                        </label>
                        <label>
                            Telefon
                            <input type="tel" name="receiver_phone" id="receiver_phone" placeholder="05XX XXX XX XX" required>
                        </label>
                    </div>
                    <label>
                        Adres
                        <input type="text" name="receiver_address" id="receiver_address" placeholder="Mahalle, sokak, bina, daire" required>
                    </label>

                    <h2>Paket Bilgileri</h2>
                    <div class="form-grid">
                        <label>
                            Paket Boyutu
                            <select name="package_size" id="package_size" required>
                                <option value="">SeÃ§iniz</option>
                                <option value="KÃ¼Ã§Ã¼k">KÃ¼Ã§Ã¼k</option>
                                <option value="Orta">Orta</option>
                                <option value="BÃ¼yÃ¼k">BÃ¼yÃ¼k</option>
                            </select>
                        </label>
                        <label>
                            Tahmini AÄŸÄ±rlÄ±k (kg)
                            <input type="number" name="package_weight" id="package_weight" step="0.1" min="0.1" placeholder="Ã–rn: 1.5" required>
                        </label>
                    </div>

                    <label>
                        Not (isteÄŸe baÄŸlÄ±)
                        <textarea name="notes" id="notes" rows="3" placeholder="Kurye iÃ§in Ã¶zel not yazabilirsin."></textarea>
                    </label>

                    <button type="submit" class="btn btn-block" id="submitBtn">GÃ¶nderiyi OluÅŸtur</button>
                    <p class="form-note" id="formNote"></p>
                </form>

                <aside class="side-box">
                    <h3>Tahmini Ãœcret</h3>
                    <p>GerÃ§ek bir sistemde, adresler ve mesafe bilgisine gÃ¶re burada tahmini Ã¼cret gÃ¶sterilir.</p>
                    <ul class="fake-price-list">
                        <li>0â€“5 km: ~50â‚º</li>
                        <li>5â€“10 km: ~80â‚º</li>
                        <li>10â€“20 km: ~120â‚º</li>
                    </ul>
                    <p class="small"></p>
                </aside>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="footer-bottom">
            Â© 2025 KapÄ± KapÄ±.
        </div>
    </footer>

    <script>
        const form = document.getElementById('shipmentForm');
        const formMessage = document.getElementById('formMessage');
        const formNote = document.getElementById('formNote');
        const submitBtn = document.getElementById('submitBtn');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Form verilerini topla
            const formData = {
                sender_name: document.getElementById('sender_name').value,
                sender_phone: document.getElementById('sender_phone').value,
                sender_address: document.getElementById('sender_address').value,
                receiver_name: document.getElementById('receiver_name').value,
                receiver_phone: document.getElementById('receiver_phone').value,
                receiver_address: document.getElementById('receiver_address').value,
                package_size: document.getElementById('package_size').value,
                package_weight: parseFloat(document.getElementById('package_weight').value),
                notes: document.getElementById('notes').value || ''
            };

            // Validasyon
            if (!formData.sender_name || !formData.sender_phone || !formData.sender_address ||
                !formData.receiver_name || !formData.receiver_phone || !formData.receiver_address ||
                !formData.package_size || !formData.package_weight) {
                showMessage('LÃ¼tfen tÃ¼m zorunlu alanlarÄ± doldurun.', 'error');
                return;
            }

            // Butonu devre dÄ±ÅŸÄ± bÄ±rak (loading state'i kaldÄ±rÄ±ldÄ± - hÄ±zlÄ± geÃ§iÅŸ iÃ§in)
            submitBtn.disabled = true;

            try {
                const response = await fetch('/api/shipments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (result.success) {
                    showMessage(`âœ… ${result.message}`, 'success');
                    submitBtn.textContent = 'âœ“ GÃ¶nderi OluÅŸturuldu';
                    submitBtn.style.background = 'linear-gradient(135deg, var(--green) 0%, var(--green-dark) 100%)';
                    formNote.innerHTML = `
                        <div style="padding: 1.5rem; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 1rem; border: 2px solid var(--green); margin-top: 1rem;">
                            <h3 style="margin: 0 0 1rem 0; color: var(--green-dark); font-size: 1.1rem;">ğŸ“¦ GÃ¶nderi OluÅŸturuldu!</h3>
                            <div style="margin-bottom: 0.8rem;">
                                <strong style="color: var(--muted); font-size: 0.9rem; display: block; margin-bottom: 0.3rem;">Takip NumarasÄ±:</strong>
                                <div style="font-size: 1.5rem; font-weight: 800; color: var(--green-dark); letter-spacing: 1px;">${result.shipment.tracking_number}</div>
                            </div>
                            <div style="margin-bottom: 0.8rem;">
                                <strong style="color: var(--muted); font-size: 0.9rem; display: block; margin-bottom: 0.3rem;">Tahmini Ãœcret:</strong>
                                <div style="font-size: 1.3rem; font-weight: 700; color: var(--text);">${result.shipment.price}â‚º</div>
                            </div>
                            <div style="padding-top: 0.8rem; border-top: 1px solid rgba(0,0,0,0.1);">
                                <a href="/takip" style="color: var(--green-dark); font-weight: 600; text-decoration: underline;">ğŸ” GÃ¶nderiyi takip etmek iÃ§in tÄ±klayÄ±n</a>
                            </div>
                        </div>
                    `;
                    form.reset();
                    submitBtn.disabled = false;
                } else {
                    showMessage(`âŒ ${result.message}`, 'error');
                    submitBtn.disabled = false;
                }
            } catch (error) {
                console.error('Hata:', error);
                showMessage('Bir hata oluÅŸtu. LÃ¼tfen tekrar deneyin.', 'error');
                submitBtn.disabled = false;
            }
        });

        function showMessage(message, type) {
            formMessage.innerHTML = `<div style="padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; ${
                type === 'success' 
                    ? 'background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb;' 
                    : 'background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb;'
            }">${message}</div>`;
            
            // MesajÄ± kaydÄ±r
            formMessage.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>

</html>